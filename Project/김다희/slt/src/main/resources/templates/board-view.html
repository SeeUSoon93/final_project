<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="/css/css_board/board-view.css">
	<script src="https://kit.fontawesome.com/08f5f8a0fd.js" crossorigin="anonymous"></script>
</head>

<body>
	<div id="header-container"></div>

	<div class="banner">
		<div class="banner-font">
			<h2>커뮤니티</h2>
			<P>커뮤니티 상세보기</P>
		</div>
	</div>

	<div class="bv-contents">
		<div class="bv-group">
			<form id="viewForm">
				<table class="tableset">
					<div class="board_view_wrap">
						<div class="board_view">
							<div class="title" id="subject">
								<h3 th:text="${tbBoard.bdTitle}"></h3>
							</div>
							<div class="info-group">
								<div class="info">
									<div id="writer" th:text="${tbBoard.tbUser.userNick}"></div>
								</div>
								<div class="info">
									<div id="date" th:text="${#temporals.format(tbBoard.createdAt, 'yyyy-MM-dd')}">
									</div>
								</div>
								<div class="info">
									<div id="views" th:text="${tbBoard.bdViews}">
										<i class="fa-regular fa-eye"></i>
									</div>
								</div>
								<div class="info">
									<div id="like" th:text="${tbBoard.bdLikes}">
										<i class="fa-solid fa-heart"></i>
									</div>
								</div>
								<div class="cont">
									<div id="content" th:text="${tbBoard.bdContent}"></div>
								</div>
								<div class="bt-group">
									<i id="heart" class="fa-regular fa-heart fa-3x"></i>
									<div class="bt_wrap">
										<button id="list" class="view-bt" type="button"
											onclick="location.href='./list.html'">목 록</button>
										<div th:if="${isAuthor}">
											<button id="modify" class="view-bt" onclick="editPost()">수 정</button>
											<button id="delete" class="view-bt" onclick="deletePost()">삭 제</button>
										</div>
									</div>
								</div>
								<!-- 댓글 시스템 시작 -->
								<div class="comments">
									<form id="comment-form">
										<textarea id="comment-text" onkeydown="resize(this)" onkeyup="resize(this)"
											placeholder="댓글을 입력하세요"></textarea>
										<button type="submit">댓글 작성</button>
									</form>
									<div id="comments-container">
										<div class="comnt-table">
											<div class="comnt-field">
												<div class="comnt-header">
													<div class="comnt-id">
														<p>kim</p>
													</div>
													<div class="comnt-date">
														<p>5분 전</p>
													</div>
												</div>
												<div class="comnt-contents">
													<div class="comnt-read">
														<p>hihihihi</p>
													</div>
												</div>
											</div>
											<div class="comnt-field">
												<div class="comnt-header">
													<div class="comnt-id">
														<p>aaaaasdgfadsgas</p>
													</div>
													<div class="comnt-date">
														<p>1분 전</p>
													</div>
												</div>
												<div class="comnt-contents">
													<div class="comnt-read">
														<p>asjdflajadsfasdfasdfads</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- 댓글 시스템 끝 -->
							</div>
						</div>
				</table>
			</form>
		</div>
	</div>

	<div id="footer-container"></div>

	<script src="/js/js_headfoot/headFoot.js"></script>
	<script>
		// 입력한 댓글 내용 가져오고, json형식으로 서버에 전송
		function addComment() {
			var content = $('#comment-text').val();
			// bdIdx 가져오기
			var bdIdx = $('#bdIdx').val();

			$.ajax({
				type: 'post',
				url: '/comment',
				contentType: 'application/json',
				data: JSON.stringify({
					"content": content,
					"bdIdx": bdIdx
				}),
				success: function (response) {
					loadComments();
				},
				error: function (error) {
					console.error('댓글 보내는데 실패하셨습니다.', error);
				}
			});
		}
		// 서버에 Get 요청을 보내서 댓글 목록 가져오는 함수
		function loadComments() {
			$.ajax({
				type: 'GET',
				url: '/comment',
				success: function (comments) {
					var commentsHtml = '';
					comments.forEach(function (comment) {
						commentsHtml += '<p>' + comment.content + '<p>';
					});
					$('#comment-form').html(commentsHtml);
				},
				error: function (error) {
					console.error('댓글 등록에 실패하셨습니다.', error);
				}
			});
		}
		// 페이지가 로드될 때 실행되는 함수로, 초기에 페이지가 로드될 때 댓글 목록을 불러와서 화면에 표시
		$(document).ready(function () {
			loadComments();
		});

		<!-- 댓글 추가 -->
		function addComment() {
			var content = $('#comment-text').val();
			var bdIdx = $('#bdIdx').val();

			$.ajax({
				type: 'post',
				url: '/comment',
				contentType: 'application/json',
				data: JSON.stringify({
					"content": content,
					"bdIdx": bdIdx
				}),
				success: function (response) {
					loadComments();
					updateCommentsContainerHeight();
				},
				error: function (error) {
					console.error('댓글 보내는데 실패하셨습니다.', error);
				}
			});
		}

		function updateCommentsContainerHeight() {
			// 댓글을 추가한 후, #comments-container의 높이를 업데이트
			var container = $('#comments-container');
			var newHeight = container[0].scrollHeight;
			container.css('height', newHeight + 'px');
		}

	</script>
</body>

</html>